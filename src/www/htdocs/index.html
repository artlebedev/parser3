@main[]
^testdom4[]
#^testdom3[]
#^testdom2[]
#^testdom1[]
#^testdom0[]
OK

@testdom4[]
$dom[^dom::set[<?xml version="1.0" encoding="windows-1251"?>

<doc>testing ןנמגונךא </doc>
]]
$response:body[^dom.file[$.encoding[windows-1251]]]

@testdom3[]
$dom[^dom::load[test.xml]]
$dom[^dom.xslt[test.xsl;$.param1(48)]]
$dom[^dom.xslt[test.xsl;$.param1(48)]]

@testdom2[]
$dom[^dom::load[test.xml]]
#^dom.save[$.encoding[windows-1251];write.xml]
#^dom.save[;write.xml]
^dom.save[$.encoding[windows-1251] $.method[xml];write.xml]
^dom.save[$.encoding[windows-1251] $.method[html];write.html]
^dom.save[$.encoding[windows-1251] $.method[text];write.txt]

@testdom1[]
$dom[^dom::load[test.xml]]
$dom[^dom.xslt[test.xsl;$.param1(48)]]
$response:body[^dom.file[$.encoding[windows-1251]]]

@testdom0[]
$dom[^dom::load[test.xml]]
^dom.save[$.encoding[windows-1251];write.xml]
^dom.string[$.encoding[windows-1251]]
$פאיכ[^dom.file[$.encoding[windows-1251]]]
^פאיכ.save[binary;writefile.xml]
$response:body[$פאיכ]
OK